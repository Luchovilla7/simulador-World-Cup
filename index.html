<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Mundial de Fútbol</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .main-content {
            padding: 30px;
        }
        
        .phase-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .phase-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .phase-btn.active {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .champion-selector {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .champion-selector select {
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 0 10px;
            min-width: 200px;
        }
        
        .simulate-btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }
        
        .simulate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .group h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
        }
        
        .team {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .team-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stars {
            color: #FFD700;
            font-size: 1.2em;
        }
        
        .qualified {
            background: linear-gradient(45deg, #4CAF50, #45a049) !important;
            color: white;
        }
        
        .matches-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin: 10px 0;
        }
        
        .match-teams {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .team-name {
            font-weight: bold;
            min-width: 120px;
        }
        
        .score {
            font-size: 1.5em;
            font-weight: bold;
            color: #FF6B6B;
            padding: 0 15px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }
        
        .phase-title {
            text-align: center;
            font-size: 2em;
            margin-bottom: 30px;
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .final-match {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            font-size: 1.2em;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .champion-celebration {
            text-align: center;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.5em;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .group-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .group-table th,
        .group-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        
        .group-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        
        .draw-section {
            text-align: center;
            padding: 20px;
        }
        
        .draw-btn {
            background: linear-gradient(45deg, #9C27B0, #673AB7);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s ease;
        }
        
        .draw-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 Simulador Mundial de Fútbol 2025 🏆</h1>
            <p>Elige tu campeón y simula el torneo completo</p>
        </div>
        
        <div class="main-content">
            <div class="phase-selector">
                <button class="phase-btn active" onclick="showPhase('setup')">Configuración</button>
                <button class="phase-btn" onclick="showPhase('draw')">Sorteo</button>
                <button class="phase-btn" onclick="showPhase('groups')">Fase de Grupos</button>
                <button class="phase-btn" onclick="showPhase('knockout')">Eliminatorias</button>
                <button class="phase-btn" onclick="showPhase('final')">Final</button>
            </div>
            
            <div id="setup" class="section active">
                <div class="champion-selector">
                    <h2>Selecciona el Campeón del Mundo</h2>
                    <p>El algoritmo ajustará los resultados para que tu equipo elegido gane el torneo</p>
                    <br>
                    <select id="championSelect">
                        <option value="">-- Elige tu campeón --</option>
                    </select>
                    <br><br>
                    <button class="simulate-btn" onclick="startTournament()">🏆 Comenzar Simulación</button>
                </div>
            </div>
            
            <div id="draw" class="section">
                <div class="draw-section">
                    <h2 class="phase-title">Sorteo de Grupos</h2>
                    <div id="drawContent">
                        <button class="draw-btn" onclick="performDraw()">🎲 Realizar Sorteo</button>
                    </div>
                </div>
            </div>
            
            <div id="groups" class="section">
                <h2 class="phase-title">Fase de Grupos</h2>
                <div id="groupsContent" class="groups-container"></div>
            </div>
            
            <div id="knockout" class="section">
                <h2 class="phase-title">Fase Eliminatoria</h2>
                <div id="knockoutContent"></div>
            </div>
            
            <div id="final" class="section">
                <h2 class="phase-title">Gran Final</h2>
                <div id="finalContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de países con sus niveles
        const countries = {
            // CONMEBOL (Sudamérica) - 5 clasificados
            'Brasil': 5, 'Argentina': 5, 'Uruguay': 4, 'Colombia': 4, 'Chile': 3,
            'Perú': 3, 'Ecuador': 3, 'Paraguay': 2, 'Bolivia': 2, 'Venezuela': 2,
            
            // UEFA (Europa) - 11 clasificados
            'Francia': 5, 'España': 5, 'Inglaterra': 5, 'Alemania': 5, 'Italia': 5,
            'Portugal': 5, 'Países Bajos': 4, 'Bélgica': 4, 'Croacia': 4, 'Dinamarca': 4,
            'Suecia': 3, 'Suiza': 3, 'Austria': 3, 'Polonia': 3, 'República Checa': 3,
            'Ucrania': 3, 'Serbia': 3, 'Eslovaquia': 2, 'Hungría': 2, 'Finlandia': 2,
            
            // CONCACAF (Norte y Centroamérica) - 4 clasificados
            'Estados Unidos': 4, 'México': 4, 'Canadá': 3, 'Costa Rica': 3,
            'Jamaica': 2, 'Honduras': 2, 'El Salvador': 2, 'Guatemala': 2,
            'Panamá': 2, 'Nicaragua': 1, 'Trinidad y Tobago': 2,
            
            // CAF (África) - 5 clasificados
            'Senegal': 4, 'Marruecos': 4, 'Nigeria': 4, 'Ghana': 3, 'Argelia': 3,
            'Túnez': 3, 'Camerún': 3, 'Mali': 3, 'Burkina Faso': 2, 'Costa de Marfil': 3,
            'Egipto': 3, 'Sudáfrica': 2, 'Kenia': 2, 'Angola': 2, 'Zambia': 2,
            
            // AFC (Asia) - 5 clasificados
            'Japón': 4, 'Corea del Sur': 4, 'Australia': 4, 'Irán': 3, 'Arabia Saudí': 3,
            'Qatar': 3, 'Irak': 3, 'Emiratos Árabes': 2, 'Jordania': 2, 'China': 2,
            'Tailandia': 2, 'Vietnam': 2, 'India': 2, 'Uzbekistán': 2,
            
            // OFC (Oceanía) - 2 clasificados
            'Nueva Zelanda': 2, 'Fiyi': 1, 'Islas Salomón': 1, 'Nueva Caledonia': 1,
            'Vanuatu': 1, 'Tahití': 1, 'Samoa': 1, 'Tonga': 1
        };
        
        let qualifiedTeams = [];
        let groups = {};
        let chosenChampion = '';
        let knockoutResults = {};
        let finalResults = {};
        
        // Inicializar selector de campeón
        function initializeChampionSelector() {
            const select = document.getElementById('championSelect');
            const sortedCountries = Object.keys(countries).sort();
            
            sortedCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = `${country} ${'⭐'.repeat(countries[country])}`;
                select.appendChild(option);
            });
        }
        
        // Clasificación automática de equipos
        function qualifyTeams() {
            const regions = {
                CONMEBOL: ['Brasil', 'Argentina', 'Uruguay', 'Colombia', 'Chile'],
                UEFA: ['Francia', 'España', 'Inglaterra', 'Alemania', 'Italia', 'Portugal', 
                       'Países Bajos', 'Bélgica', 'Croacia', 'Dinamarca', 'Suecia'],
                CONCACAF: ['Estados Unidos', 'México', 'Canadá', 'Costa Rica'],
                CAF: ['Senegal', 'Marruecos', 'Nigeria', 'Ghana', 'Argelia'],
                AFC: ['Japón', 'Corea del Sur', 'Australia', 'Irán', 'Arabia Saudí'],
                OFC: ['Nueva Zelanda', 'Fiji']
            };
            
            qualifiedTeams = [];
            Object.values(regions).forEach(region => {
                qualifiedTeams.push(...region);
            });
            
            // Asegurar que el campeón elegido esté clasificado
            if (chosenChampion && !qualifiedTeams.includes(chosenChampion)) {
                // Reemplazar un equipo aleatorio de la misma región
                const championRegion = getRegion(chosenChampion);
                const regionTeams = regions[championRegion] || [];
                if (regionTeams.length > 0) {
                    const randomIndex = Math.floor(Math.random() * regionTeams.length);
                    const indexInQualified = qualifiedTeams.indexOf(regionTeams[randomIndex]);
                    if (indexInQualified !== -1) {
                        qualifiedTeams[indexInQualified] = chosenChampion;
                    }
                }
            }
        }
        
        function getRegion(country) {
            const regions = {
                CONMEBOL: ['Brasil', 'Argentina', 'Uruguay', 'Colombia', 'Chile', 'Perú', 'Ecuador', 'Paraguay', 'Bolivia', 'Venezuela'],
                UEFA: ['Francia', 'España', 'Inglaterra', 'Alemania', 'Italia', 'Portugal', 'Países Bajos', 'Bélgica', 'Croacia', 'Dinamarca', 'Suecia', 'Suiza', 'Austria', 'Polonia', 'República Checa', 'Ucrania', 'Serbia', 'Eslovaquia', 'Hungría', 'Finlandia'],
                CONCACAF: ['Estados Unidos', 'México', 'Canadá', 'Costa Rica', 'Jamaica', 'Honduras', 'El Salvador', 'Guatemala', 'Panamá', 'Nicaragua', 'Trinidad y Tobago'],
                CAF: ['Senegal', 'Marruecos', 'Nigeria', 'Ghana', 'Argelia', 'Túnez', 'Camerún', 'Mali', 'Burkina Faso', 'Costa de Marfil', 'Egipto', 'Sudáfrica', 'Kenia', 'Angola', 'Zambia'],
                AFC: ['Japón', 'Corea del Sur', 'Australia', 'Irán', 'Arabia Saudí', 'Qatar', 'Irak', 'Emiratos Árabes', 'Jordania', 'China', 'Tailandia', 'Vietnam', 'India', 'Uzbekistán'],
                OFC: ['Nueva Zelanda', 'Fiyi', 'Islas Salomón', 'Nueva Caledonia', 'Vanuatu', 'Tahití', 'Samoa', 'Tonga']
            };
            
            for (const [region, teams] of Object.entries(regions)) {
                if (teams.includes(country)) return region;
            }
            return 'UEFA'; // Default
        }
        
        // Realizar sorteo de grupos
        function performDraw() {
            const shuffled = [...qualifiedTeams].sort(() => Math.random() - 0.5);
            groups = {};
            
            for (let i = 0; i < 8; i++) {
                const groupLetter = String.fromCharCode(65 + i);
                groups[groupLetter] = [];
                for (let j = 0; j < 4; j++) {
                    groups[groupLetter].push(shuffled[i * 4 + j]);
                }
            }
            
            displayDraw();
        }
        
        function displayDraw() {
            const content = document.getElementById('drawContent');
            let html = '<h3>Grupos Sorteados</h3><div class="groups-container">';
            
            Object.entries(groups).forEach(([letter, teams]) => {
                html += `<div class="group">
                    <h3>Grupo ${letter}</h3>`;
                teams.forEach(team => {
                    html += `<div class="team">
                        <div class="team-info">
                            <span class="team-name">${team}</span>
                            <span class="stars">${'⭐'.repeat(countries[team])}</span>
                        </div>
                    </div>`;
                });
                html += '</div>';
            });
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        // Simular partido
        function simulateMatch(team1, team2, isFinal = false) {
            const level1 = countries[team1];
            const level2 = countries[team2];
            
            let prob1 = level1 / (level1 + level2);
            
            // Ajustar probabilidad si uno es el campeón elegido
            if (team1 === chosenChampion) {
                prob1 = Math.min(0.85, prob1 + 0.3);
            } else if (team2 === chosenChampion) {
                prob1 = Math.max(0.15, prob1 - 0.3);
            }
            
            const random = Math.random();
            let winner, score1, score2;
            
            if (random < prob1) {
                winner = team1;
                score1 = Math.floor(Math.random() * 3) + 1;
                score2 = Math.floor(Math.random() * score1);
            } else {
                winner = team2;
                score2 = Math.floor(Math.random() * 3) + 1;
                score1 = Math.floor(Math.random() * score2);
            }
            
            // Ajustar para partidos más realistas
            const levelDiff = Math.abs(level1 - level2);
            if (levelDiff <= 1) {
                // Equipos similares, más empates posibles
                if (Math.random() < 0.2) {
                    score1 = score2 = Math.floor(Math.random() * 3);
                    winner = Math.random() < 0.5 ? team1 : team2;
                    if (isFinal) {
                        // En final no hay empates
                        if (Math.random() < 0.5) {
                            score1++;
                        } else {
                            score2++;
                        }
                        winner = score1 > score2 ? team1 : team2;
                    }
                }
            }
            
            return { team1, team2, score1, score2, winner };
        }
        
        // Simular fase de grupos
        function simulateGroups() {
            const groupResults = {};
            
            Object.entries(groups).forEach(([letter, teams]) => {
                const matches = [];
                const standings = teams.map(team => ({
                    team,
                    points: 0,
                    goals: 0,
                    goalsAgainst: 0,
                    diff: 0
                }));
                
                // Todos contra todos
                for (let i = 0; i < teams.length; i++) {
                    for (let j = i + 1; j < teams.length; j++) {
                        const match = simulateMatch(teams[i], teams[j]);
                        matches.push(match);
                        
                        // Actualizar estadísticas
                        const team1Stats = standings.find(s => s.team === match.team1);
                        const team2Stats = standings.find(s => s.team === match.team2);
                        
                        team1Stats.goals += match.score1;
                        team1Stats.goalsAgainst += match.score2;
                        team2Stats.goals += match.score2;
                        team2Stats.goalsAgainst += match.score1;
                        
                        if (match.score1 > match.score2) {
                            team1Stats.points += 3;
                        } else if (match.score2 > match.score1) {
                            team2Stats.points += 3;
                        } else {
                            team1Stats.points += 1;
                            team2Stats.points += 1;
                        }
                    }
                }
                
                // Calcular diferencia de goles y ordenar
                standings.forEach(s => s.diff = s.goals - s.goalsAgainst);
                standings.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.diff !== a.diff) return b.diff - a.diff;
                    return b.goals - a.goals;
                });
                
                groupResults[letter] = { matches, standings };
            });
            
            displayGroups(groupResults);
            return groupResults;
        }
        
        function displayGroups(groupResults) {
            const content = document.getElementById('groupsContent');
            let html = '';
            
            Object.entries(groupResults).forEach(([letter, result]) => {
                html += `<div class="group">
                    <h3>Grupo ${letter}</h3>
                    <table class="group-table">
                        <tr>
                            <th>Pos</th>
                            <th>Equipo</th>
                            <th>Pts</th>
                            <th>GF</th>
                            <th>GC</th>
                            <th>Dif</th>
                        </tr>`;
                
                result.standings.forEach((team, index) => {
                    const qualified = index < 2 ? 'qualified' : '';
                    html += `<tr class="${qualified}">
                        <td>${index + 1}</td>
                        <td>${team.team} ${'⭐'.repeat(countries[team.team])}</td>
                        <td>${team.points}</td>
                        <td>${team.goals}</td>
                        <td>${team.goalsAgainst}</td>
                        <td>${team.diff}</td>
                    </tr>`;
                });
                
                html += '</table><h4>Partidos:</h4>';
                
                result.matches.forEach(match => {
                    html += `<div class="match">
                        <div class="match-teams">
                            <span class="team-name">${match.team1}</span>
                            <span class="score">${match.score1} - ${match.score2}</span>
                            <span class="team-name">${match.team2}</span>
                        </div>
                    </div>`;
                });
                
                html += '</div>';
            });
            
            content.innerHTML = html;
        }
        
        // Simular eliminatorias
        function simulateKnockout(groupResults) {
            const qualified = [];
            Object.values(groupResults).forEach(group => {
                qualified.push(group.standings[0].team, group.standings[1].team);
            });
            
            const rounds = ['Octavos', 'Cuartos', 'Semifinal'];
            let currentTeams = qualified;
            knockoutResults = {};
            
            rounds.forEach(round => {
                const matches = [];
                const winners = [];
                
                if (round === 'Octavos') {
                    // Enfrentar 1ros vs 2dos de otros grupos
                    for (let i = 0; i < 8; i++) {
                        const team1 = currentTeams[i];
                        const team2 = currentTeams[15 - i];
                        const match = simulateMatch(team1, team2);
                        matches.push(match);
                        winners.push(match.winner);
                    }
                } else {
                    // Enfrentamientos directos
                    for (let i = 0; i < currentTeams.length; i += 2) {
                        const match = simulateMatch(currentTeams[i], currentTeams[i + 1]);
                        matches.push(match);
                        winners.push(match.winner);
                    }
                }
                
                knockoutResults[round] = matches;
                currentTeams = winners;
            });
            
            // Final y 3er puesto
            const finalMatch = simulateMatch(currentTeams[0], currentTeams[1], true);
            finalResults.final = finalMatch;
            
            // Partido por el 3er puesto (perdedores de semifinal)
            const semifinalLosers = knockoutResults.Semifinal.map(match => 
                match.winner === match.team1 ? match.team2 : match.team1
            );
            const thirdPlaceMatch = simulateMatch(semifinalLosers[0], semifinalLosers[1]);
            finalResults.thirdPlace = thirdPlaceMatch;
            
            displayKnockout();
            displayFinal();
        }
        
        function displayKnockout() {
            const content = document.getElementById('knockoutContent');
            let html = '';
            
            Object.entries(knockoutResults).forEach(([round, matches]) => {
                html += `<h3>${round} de Final</h3><div class="matches-container">`;
                matches.forEach(match => {
                    const winnerClass = match.winner === chosenChampion ? 'champion-celebration' : '';
                    html += `<div class="match ${winnerClass}">
                        <div class="match-teams">
                            <span class="team-name">${match.team1}</span>
                            <span class="score">${match.score1} - ${match.score2}</span>
                            <span class="team-name">${match.team2}</span>
                        </div>
                        <div>🏆 ${match.winner}</div>
                    </div>`;
                });
                html += '</div>';
            });
            
            content.innerHTML = html;
        }
        
        function displayFinal() {
            const content = document.getElementById('finalContent');
            const final = finalResults.final;
            const third = finalResults.thirdPlace;
            
            let html = `
                <div class="match final-match">
                    <h3>🏆 GRAN FINAL 🏆</h3>
                    <div class="match-teams">
                        <span class="team-name">${final.team1}</span>
                        <span class="score">${final.score1} - ${final.score2}</span>
                        <span class="team-name">${final.team2}</span>
                    </div>
                </div>
                
                <div class="champion-celebration">
                    🎉 ¡${final.winner} es el CAMPEÓN DEL MUNDO! 🎉
                    ${final.winner === chosenChampion ? '<br>¡Tu predicción fue correcta!' : '<br>¡Sorpresa en el resultado!'}
                </div>
                
                <h3>Partido por el 3er Puesto</h3>
                <div class="match">
                    <div class="match-teams">
                        <span class="team-